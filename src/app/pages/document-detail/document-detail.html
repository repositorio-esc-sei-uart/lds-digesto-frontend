<!--
  Se define la plantilla para la vista de detalle de un documento.
  Se utiliza el nuevo control de flujo '@if' para renderizar condicionalmente el contenido.
-->

<!-- @if (documento) Bloque que se muestra si el documento se encuentra. -->
@if (documento) {
  <!-- Secci칩n de Acciones: Bot칩n 'Volver'. -->
  <div class="page-actions">
    <a mat-stroked-button routerLink="/home">
      <mat-icon>arrow_back</mat-icon>
      <span>Volver al inicio</span>
    </a>
  </div>

  <!-- Contenedor Principal en Grilla -->
  <div class="detail-container">

    <!-- Columna Izquierda: Contenido Principal -->
    <div class="document-content">
      <!-- Card Principal con Resumen -->
      <mat-card>
        <mat-card-header>
          <mat-card-title>{{ documento.titulo }}</mat-card-title>
          <mat-card-subtitle>{{ documento.numDocumento }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <h3 class="summary-title">Resumen</h3>
          <p class="document-body">{{ documento.resumen }}</p>
        </mat-card-content>
      </mat-card>

      <!-- Card de Archivos Adjuntos -->
      @if (documento.archivos && documento.archivos.length > 0) {
        <mat-card class="section-card">
          <mat-card-content>
            <h3><mat-icon>attach_file</mat-icon> Archivos Adjuntos</h3>
            <div class="file-list">
              @for (archivo of documento.archivos; track archivo.idArchivo) {
                <a [href]="archivo.url" target="_blank" class="file-item">
                  <mat-icon>picture_as_pdf</mat-icon>
                  <span>{{ archivo.nombre }}</span>
                </a>
              }
            </div>
          </mat-card-content>
        </mat-card>
      }

      <!-- Card de Documentos Relacionados (Referencias) -->
      @if (documento.referencias && documento.referencias.length > 0) {
        <mat-card class="section-card">
          <mat-card-content>
            <h3><mat-icon>link</mat-icon> Este documento hace referencia a:</h3>
            <div class="references-list">
              @for (ref of documento.referencias; track ref.idDocumento) {
                <a class="reference-item" [routerLink]="['/documento', ref.idDocumento]">
                  <mat-icon>article</mat-icon>
                  <span>{{ ref.numDocumento }}</span>
                </a>
              }
            </div>
          </mat-card-content>
        </mat-card>
      }

      <!-- Card de Documentos Relacionados (Referenciado Por) -->
      @if (documento.referenciadoPor && documento.referenciadoPor.length > 0) {
        <mat-card class="section-card">
          <mat-card-content>
            <h3><mat-icon>link</mat-icon> Este documento es referenciado por:</h3>
            <div class="references-list">
              @for (ref of documento.referenciadoPor; track ref.idDocumento) {
                <a class="reference-item" [routerLink]="['/documento', ref.idDocumento]">
                  <mat-icon>article</mat-icon>
                  <span>{{ ref.numDocumento }}</span>
                </a>
              }
            </div>
          </mat-card-content>
        </mat-card>
      }
    </div>

    <!-- Columna Derecha: Barra Lateral con Metadatos -->
    <div class="document-sidebar">
      <!-- Card de Detalles -->
      <mat-card>
        <mat-card-content>
          <h3>Detalles del Documento</h3>
          <!-- Metadatos (Estado, Tipo, Sector, Fecha) -->
          <div class="metadata-item">
            <mat-icon>label_important</mat-icon>
            <div class="metadata-text">
              <span>Estado</span>
              <strong [ngClass]="'status-' + documento.estado.nombre.split(' ')[0]">{{ documento.estado.nombre }}</strong>
            </div>
          </div>
          <div class="metadata-item">
            <mat-icon>assignment</mat-icon>
            <div class="metadata-text">
              <span>Tipo</span>
              <strong>{{ documento.tipoDocumento.nombre }}</strong>
            </div>
          </div>
          <div class="metadata-item">
            <mat-icon>corporate_fare</mat-icon>
            <div class="metadata-text">
              <span>Sector Emisor</span>
              <strong>{{ documento.sector.nombre }}</strong>
            </div>
          </div>
          <div class="metadata-item">
            <mat-icon>calendar_today</mat-icon>
            <div class="metadata-text">
              <span>Fecha de Creaci칩n</span>
              <strong>{{ documento.fechaCreacion | date:'dd/MM/yyyy' }}</strong>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Card de Palabras Clave -->
      @if (documento.palabrasClave && documento.palabrasClave.length > 0) {
        <mat-card class="section-card">
          <mat-card-content>
            <h3><mat-icon>sell</mat-icon> Palabras Clave</h3>
            <div class="keywords-container">
              @for (keyword of documento.palabrasClave; track keyword) {
                <span class="keyword-chip">{{ keyword }}</span>
              }
            </div>
          </mat-card-content>
        </mat-card>
      }
    </div>
  </div>
} @else {
  <!-- Bloque que se muestra si el documento NO se encuentra. -->
  <div class="not-found-container">
    <mat-icon>search_off</mat-icon>
    <h2>Documento no Encontrado</h2>
    <p>El documento que est치s buscando no existe o fue movido.</p>
    <a mat-stroked-button routerLink="/home">Volver al inicio</a>
  </div>
}

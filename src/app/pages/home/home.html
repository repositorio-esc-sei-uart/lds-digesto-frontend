<!--
  Se define la plantilla para la página de inicio.
  Se estructura en dos secciones principales: una para filtros y otra para mostrar los resultados.
-->
<div class="home-container">

  <!-- Sección de Selección de Filtros -->
  <section class="selection-section">

    <!-- Header con título y botón de limpiar filtros -->
    <div class="filter-header">
      <h2><mat-icon>filter_list</mat-icon> Tipos de Documento</h2>
      @if (isFilterActive) {
        <button mat-stroked-button color="warn"
                class="clear-filter-button"
                (click)="limpiarTodosLosFiltros()">
          <mat-icon>clear_all</mat-icon>
          Limpiar Filtros
        </button>
      }
    </div>

    <p>Seleccione una categoría para filtrar los documentos publicados.</p>

    <div class="filter-buttons">
      <!-- Botón para mostrar todos los documentos -->
      <button mat-stroked-button
              (click)="selectCategory('todos', undefined)"
              [class.active-filter]="categoriaSeleccionada === 'todos'">
        Todos
        <span class="badge">{{ totalDocumentos }}</span>
      </button>

      <!-- Se utiliza el bloque @for para iterar y crear un botón por cada tipo de documento. -->
      @for (tipo of tiposDeDocumento; track tipo.idTipoDocumento) {
        <button mat-stroked-button
                (click)="selectCategory(tipo.nombre, tipo.idTipoDocumento)"
                [class.active-filter]="categoriaSeleccionada === tipo.nombre">
          <span>{{ tipo.nombre }}</span>
          <span class="badge">{{ conteoPorTipo[tipo.idTipoDocumento] || 0 }}</span>
        </button>
      }
    </div>
  </section>

  <!-- Sección de Resultados de Documentos -->
  <section class="results-section">
    <!-- Grilla que contiene las tarjetas de los documentos filtrados. -->
    <div class="document-grid">
      <!-- Se itera sobre la lista 'documentosFiltrados' para mostrar una tarjeta por cada documento. -->
      @for (doc of documentosFiltrados; track doc.idDocumento) {
        <mat-card class="document-card" (click)="onCardClick(doc.idDocumento)">
          <mat-card-header>
            <mat-card-title>{{ doc.titulo }}</mat-card-title>
            <mat-card-subtitle>{{ doc.numDocumento }}</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <p>
              <!-- Se trunca el texto del resumen. -->
              <span class="truncate-text" [matTooltip]="doc.resumen">{{ doc.resumen }}</span>
            </p>
            <span class="creation-date">
              Fecha de creación {{ doc.fechaCreacion | date:'dd/MM/yyyy' }}
            </span>
          </mat-card-content>
        </mat-card>
      }
    </div>

    <!-- Se muestra un mensaje si la lista de 'documentosFiltrados' está vacía. -->
    @if (documentosFiltrados.length === 0) {
      <div class="no-results">
        <mat-icon>search_off</mat-icon>
        <p>No se encontraron documentos para los filtros aplicados.</p>
      </div>
    }

    <!-- Paginador -->
    @if (totalElements > 0) {
      <mat-paginator
        [length]="totalElements"
        [pageSize]="pageSize"
        [pageIndex]="currentPage"
        [pageSizeOptions]="[6, 12, 18]"
        (page)="onPageChange($event)"
        showFirstLastButtons>
      </mat-paginator>
    }
  </section>
</div>
